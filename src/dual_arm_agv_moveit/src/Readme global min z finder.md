# å…¨å±€æœ€ä½ Z åæ ‡è‡ªåŠ¨æœç´¢å·¥å…·

## åŠŸèƒ½è¯´æ˜

è¿™ä¸ªå·¥å…·ä¼š**è‡ªåŠ¨æœç´¢æ•´ä¸ªå·¥ä½œç©ºé—´**,åœ¨å¤šä¸ª XY ä½ç½®å’Œå¤šç§å§¿æ€ä¸‹æµ‹è¯•,æ‰¾åˆ°æœºæ¢°è‡‚æœ«ç«¯æ‰§è¡Œå™¨èƒ½è¾¾åˆ°çš„**å…¨å±€æœ€ä½ Z åæ ‡**ã€‚

## æ ¸å¿ƒç‰¹æ€§

âœ… **å…¨è‡ªåŠ¨**: è‡ªåŠ¨éå† XY å¹³é¢å’Œå¤šç§å§¿æ€ç»„åˆ
âœ… **æ™ºèƒ½æœç´¢**: æ¯ä¸ªä½ç½®è‡ªåŠ¨æ‰¾åˆ°è¯¥ç‚¹çš„æœ€ä½ Z å€¼
âœ… **å¤šå§¿æ€æµ‹è¯•**: æµ‹è¯•5ç§å¸¸ç”¨å§¿æ€(å‚ç›´ã€å€¾æ–œã€æ°´å¹³ç­‰)
âœ… **å…¨å±€æœ€ä¼˜**: è‡ªåŠ¨æ‰¾å‡ºæ‰€æœ‰æµ‹è¯•ä¸­çš„æœ€ä½ç‚¹
âœ… **è¿›åº¦æ˜¾ç¤º**: å®æ—¶æ˜¾ç¤ºæœç´¢è¿›åº¦å’Œå½“å‰æœ€ä¼˜ç»“æœ
âœ… **è¯¦ç»†æŠ¥å‘Š**: è¾“å‡ºå®Œæ•´çš„ç»Ÿè®¡ä¿¡æ¯å’Œå‰10ä¸ªæœ€ä½ç‚¹

## ç¼–è¯‘

```bash
cd ~/your_workspace
colcon build --packages-select dual_arm_agv_moveit
source install/setup.bash
```

## åŸºæœ¬ä½¿ç”¨

### 1. å¿«é€Ÿå¼€å§‹(ä½¿ç”¨é»˜è®¤å‚æ•°)

```bash
ros2 run dual_arm_agv_moveit global_min_z_finder \
  --ros-args \
  -p arm_group:=arm_l
```

è¿™å°†åœ¨é»˜è®¤å·¥ä½œç©ºé—´å†…æœç´¢,ä½¿ç”¨5ç§é¢„å®šä¹‰å§¿æ€ã€‚

### 2. è‡ªå®šä¹‰æœç´¢èŒƒå›´

```bash
ros2 run dual_arm_agv_moveit global_min_z_finder \
  --ros-args \
  -p arm_group:=arm_l \
  -p x_min:=0.2 \
  -p x_max:=0.4 \
  -p x_step:=0.05 \
  -p y_min:=-0.9 \
  -p y_max:=-0.7 \
  -p y_step:=0.05 \
  -p z_start:=1.5 \
  -p z_min:=0.3 \
  -p z_step:=0.02
```

### 3. åªæµ‹è¯•å•ä¸€å§¿æ€(å‚ç›´å‘ä¸‹)

```bash
ros2 run dual_arm_agv_moveit global_min_z_finder \
  --ros-args \
  -p arm_group:=arm_l \
  -p test_orientations:=false
```

### 4. å¿«é€Ÿç²—ç•¥æœç´¢(å¤§æ­¥é•¿)

```bash
ros2 run dual_arm_agv_moveit global_min_z_finder \
  --ros-args \
  -p arm_group:=arm_l \
  -p x_step:=0.1 \
  -p y_step:=0.1 \
  -p z_step:=0.05
```

### 5. ç²¾ç»†æœç´¢(å°æ­¥é•¿,åœ¨å·²çŸ¥åŒºåŸŸ)

```bash
ros2 run dual_arm_agv_moveit global_min_z_finder \
  --ros-args \
  -p arm_group:=arm_l \
  -p x_min:=0.25 \
  -p x_max:=0.35 \
  -p x_step:=0.02 \
  -p y_min:=-0.85 \
  -p y_max:=-0.75 \
  -p y_step:=0.02 \
  -p z_step:=0.01
```

## å‚æ•°è¯¦è§£

### åŸºæœ¬å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `arm_group` | string | arm_l | è§„åˆ’ç»„ (arm_l æˆ– arm_r) |

### XY æœç´¢èŒƒå›´

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `x_min` | double | 0.15 | X åæ ‡æœ€å°å€¼ (ç±³) |
| `x_max` | double | 0.45 | X åæ ‡æœ€å¤§å€¼ (ç±³) |
| `x_step` | double | 0.05 | X è½´æœç´¢æ­¥é•¿ (ç±³) |
| `y_min` | double | -1.0 | Y åæ ‡æœ€å°å€¼ (ç±³) |
| `y_max` | double | -0.6 | Y åæ ‡æœ€å¤§å€¼ (ç±³) |
| `y_step` | double | 0.05 | Y è½´æœç´¢æ­¥é•¿ (ç±³) |

### Z æœç´¢èŒƒå›´

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `z_start` | double | 1.5 | Z æœç´¢èµ·å§‹é«˜åº¦ (ç±³) |
| `z_min` | double | 0.2 | Z æœç´¢æœ€ä½é«˜åº¦ (ç±³) |
| `z_step` | double | 0.02 | Z è½´æœç´¢æ­¥é•¿ (ç±³) |

### å§¿æ€é…ç½®

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `test_orientations` | bool | true | æ˜¯å¦æµ‹è¯•å¤šç§å§¿æ€ |

### è§„åˆ’å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `planning_time` | double | 3.0 | æ¯æ¬¡è§„åˆ’æœ€å¤§æ—¶é—´ (ç§’) |
| `planning_attempts` | int | 5 | æ¯æ¬¡è§„åˆ’å°è¯•æ¬¡æ•° |

## é¢„å®šä¹‰å§¿æ€

ç¨‹åºå†…ç½®äº†5ç§å¸¸ç”¨å§¿æ€:

| å§¿æ€åç§° | æè¿° | å››å…ƒæ•° [x, y, z, w] | é€‚ç”¨åœºæ™¯ |
|---------|------|-------------------|---------|
| `vertical_down` | å‚ç›´å‘ä¸‹ | [0.5, -0.5, -0.5, 0.5] | æŠ“å–ã€æ”¾ç½® |
| `tilt_45deg` | 45åº¦å€¾æ–œ | [0.383, -0.383, -0.383, 0.707] | å€¾æ–œæŠ“å– |
| `tilt_30deg` | 30åº¦å€¾æ–œ | [0.259, -0.259, -0.259, 0.866] | è½»å¾®å€¾æ–œ |
| `horizontal_forward` | æ°´å¹³å‘å‰ | [0.0, 0.707, -0.707, 0.0] | æ°´å¹³æ’å…¥ |
| `side_grasp` | ä¾§å‘æŠ“å– | [0.707, 0.0, 0.0, 0.707] | ä¾§é¢æ“ä½œ |

## æœç´¢ç­–ç•¥

### ä¸¤é˜¶æ®µæœç´¢(æ¨è)

**ç¬¬ä¸€é˜¶æ®µ: ç²—æœç´¢**
```bash
# å¿«é€Ÿæ‰¾åˆ°å¤§æ¦‚åŒºåŸŸ
ros2 run dual_arm_agv_moveit global_min_z_finder \
  --ros-args \
  -p arm_group:=arm_l \
  -p x_min:=0.1 \
  -p x_max:=0.5 \
  -p x_step:=0.1 \
  -p y_min:=-1.0 \
  -p y_max:=-0.5 \
  -p y_step:=0.1 \
  -p z_step:=0.05
```

å‡è®¾æ‰¾åˆ°æœ€ä½ç‚¹åœ¨ (X=0.3, Y=-0.8, Z=0.45)

**ç¬¬äºŒé˜¶æ®µ: ç²¾æœç´¢**
```bash
# åœ¨æ‰¾åˆ°çš„åŒºåŸŸé™„è¿‘ç²¾ç»†æœç´¢
ros2 run dual_arm_agv_moveit global_min_z_finder \
  --ros-args \
  -p arm_group:=arm_l \
  -p x_min:=0.25 \
  -p x_max:=0.35 \
  -p x_step:=0.01 \
  -p y_min:=-0.85 \
  -p y_max:=-0.75 \
  -p y_step:=0.01 \
  -p z_min:=0.4 \
  -p z_step:=0.005
```

## è¾“å‡ºç»“æœè¯´æ˜

ç¨‹åºä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯:

### 1. æœç´¢é…ç½®
- XY æœç´¢èŒƒå›´å’Œæ­¥é•¿
- Z æœç´¢èŒƒå›´å’Œæ­¥é•¿
- æµ‹è¯•å§¿æ€åˆ—è¡¨
- é¢„è®¡æµ‹è¯•æ—¶é—´

### 2. å®æ—¶è¿›åº¦
- æ¯ä¸ªæµ‹è¯•ç‚¹çš„ç»“æœ
- æ¯10ä¸ªæµ‹è¯•æ˜¾ç¤ºä¸€æ¬¡è¿›åº¦ç»Ÿè®¡
- å½“å‰æ‰¾åˆ°çš„æœ€ä½ç‚¹

### 3. æœ€ç»ˆç»“æœ
- **å…¨å±€æœ€ä½ Z åæ ‡**åŠå…¶ä½ç½®
- å¯¹åº”çš„å§¿æ€ä¿¡æ¯
- ROS2 æœåŠ¡è°ƒç”¨å‘½ä»¤(å¯ç›´æ¥ä½¿ç”¨)
- YAML æ ¼å¼é…ç½®
- å‰10ä¸ªæœ€ä½ç‚¹åˆ—è¡¨

### 4. ç»Ÿè®¡ä¿¡æ¯
- æ€»æµ‹è¯•æ•°
- æˆåŠŸç‡
- æ€»è€—æ—¶

## å®é™…ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1: ç”µæ± æ‹†è§£ - æ‰¾æœ€æ·±å¯è¾¾ä½ç½®

```bash
# åœ¨ç”µæ± åŒºåŸŸæœç´¢æœ€ä½ç‚¹
ros2 run dual_arm_agv_moveit global_min_z_finder \
  --ros-args \
  -p arm_group:=arm_l \
  -p x_min:=0.3 \
  -p x_max:=0.5 \
  -p x_step:=0.05 \
  -p y_min:=-0.7 \
  -p y_max:=-0.5 \
  -p y_step:=0.05 \
  -p z_start:=1.2 \
  -p z_min:=0.4
```

### åœºæ™¯ 2: å·¥ä½œå°æ“ä½œ - å…¨å·¥ä½œç©ºé—´æ‰«æ

```bash
# æ‰«ææ•´ä¸ªå·¥ä½œå°åŒºåŸŸ
ros2 run dual_arm_agv_moveit global_min_z_finder \
  --ros-args \
  -p arm_group:=arm_r \
  -p x_min:=0.2 \
  -p x_max:=0.6 \
  -p x_step:=0.1 \
  -p y_min:=0.5 \
  -p y_max:=1.0 \
  -p y_step:=0.1
```

### åœºæ™¯ 3: ç²¾ç¡®å®šä½ - å°èŒƒå›´é«˜ç²¾åº¦

```bash
# åœ¨å·²çŸ¥ä½ç½®é™„è¿‘ç²¾ç¡®æœç´¢
ros2 run dual_arm_agv_moveit global_min_z_finder \
  --ros-args \
  -p arm_group:=arm_l \
  -p x_min:=0.28 \
  -p x_max:=0.32 \
  -p x_step:=0.005 \
  -p y_min:=-0.82 \
  -p y_max:=-0.78 \
  -p y_step:=0.005 \
  -p z_step:=0.005
```

## æ€§èƒ½ä¼˜åŒ–

### å‡å°‘æµ‹è¯•æ—¶é—´

1. **å‡å°‘æµ‹è¯•ç‚¹æ•°é‡**
   ```bash
   # å¢å¤§æ­¥é•¿
   -p x_step:=0.1 -p y_step:=0.1 -p z_step:=0.05
   ```

2. **åªæµ‹è¯•å•ä¸€å§¿æ€**
   ```bash
   -p test_orientations:=false
   ```

3. **å‡å°‘è§„åˆ’æ—¶é—´**
   ```bash
   -p planning_time:=2.0 -p planning_attempts:=3
   ```

4. **ç¼©å°æœç´¢èŒƒå›´**
   ```bash
   # åœ¨å·²çŸ¥å·¥ä½œåŒºåŸŸæœç´¢
   -p x_min:=0.25 -p x_max:=0.35
   ```

### æé«˜æœç´¢ç²¾åº¦

1. **å‡å°æ­¥é•¿**
   ```bash
   -p x_step:=0.01 -p y_step:=0.01 -p z_step:=0.005
   ```

2. **å¢åŠ è§„åˆ’æ—¶é—´**
   ```bash
   -p planning_time:=10.0 -p planning_attempts:=20
   ```

## ä¼°ç®—æœç´¢æ—¶é—´

**è®¡ç®—å…¬å¼:**
```
æµ‹è¯•ç‚¹æ•° = [(x_max-x_min)/x_step + 1] Ã— [(y_max-y_min)/y_step + 1] Ã— å§¿æ€æ•°
æ¯ä¸ªæµ‹è¯•çº¦ 2-5 ç§’
æ€»æ—¶é—´ â‰ˆ æµ‹è¯•ç‚¹æ•° Ã— 3 ç§’
```

**ç¤ºä¾‹:**
```bash
# å‚æ•°é…ç½®:
x: [0.2, 0.4] step 0.05 â†’ 5ä¸ªç‚¹
y: [-0.9, -0.7] step 0.05 â†’ 5ä¸ªç‚¹
å§¿æ€: 5ç§

æµ‹è¯•ç‚¹æ•° = 5 Ã— 5 Ã— 5 = 125
é¢„è®¡æ—¶é—´ = 125 Ã— 3ç§’ â‰ˆ 6åˆ†é’Ÿ
```

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æœç´¢æ—¶é—´å¤ªé•¿

**è§£å†³æ–¹æ³•:**
```bash
# 1. å¢å¤§æ­¥é•¿
-p x_step:=0.1 -p y_step:=0.1

# 2. åªæµ‹è¯•å•ä¸€å§¿æ€
-p test_orientations:=false

# 3. ç¼©å°æœç´¢èŒƒå›´
-p x_min:=0.2 -p x_max:=0.4
```

### é—®é¢˜ 2: æ‰€æœ‰ä½ç½®éƒ½ä¸å¯è¾¾

**è§£å†³æ–¹æ³•:**
```bash
# 1. æ‰©å¤§æœç´¢èŒƒå›´
-p x_min:=0.1 -p x_max:=0.6 -p y_min:=-1.2 -p y_max:=-0.4

# 2. å¢å¤§èµ·å§‹Zé«˜åº¦
-p z_start:=2.0

# 3. æµ‹è¯•å¤šç§å§¿æ€
-p test_orientations:=true
```

### é—®é¢˜ 3: å†…å­˜ä¸è¶³

**è§£å†³æ–¹æ³•:**
```bash
# å‡å°‘è§„åˆ’å°è¯•æ¬¡æ•°
-p planning_attempts:=3

# å‡å°‘è§„åˆ’æ—¶é—´
-p planning_time:=2.0
```

## ä¸å…¶ä»–å·¥å…·å¯¹æ¯”

| å·¥å…· | ç”¨é€” | XY | å§¿æ€ | è¾“å‡º |
|------|------|----|----|------|
| `find_min_z_position` | å¿«é€Ÿæµ‹è¯•å›ºå®šä½ç½® | å›ºå®š | å›ºå®š | ç®€å• |
| `find_min_z_universal` | æµ‹è¯•ä»»æ„é…ç½® | æ‰‹åŠ¨æŒ‡å®š | æ‰‹åŠ¨æŒ‡å®š | è¯¦ç»† |
| `global_min_z_finder` | è‡ªåŠ¨æ‰¾å…¨å±€æœ€ä½ | è‡ªåŠ¨éå† | å¤šç§æµ‹è¯• | å®Œæ•´æŠ¥å‘Š |

## æœ€ä½³å®è·µ

1. **å…ˆç²—åç²¾**: å…ˆç”¨å¤§æ­¥é•¿å¿«é€Ÿå®šä½,å†ç”¨å°æ­¥é•¿ç²¾ç¡®æœç´¢
2. **åˆç†èŒƒå›´**: æ ¹æ®æœºå™¨äººå®é™…å·¥ä½œç©ºé—´è®¾ç½®æœç´¢èŒƒå›´
3. **ä¿å­˜ç»“æœ**: è®°å½•è¾“å‡ºçš„æœ€ä¼˜ä½ç½®å’Œå§¿æ€
4. **éªŒè¯ç»“æœ**: ä½¿ç”¨è¾“å‡ºçš„æœåŠ¡å‘½ä»¤å®é™…æµ‹è¯•
5. **å¤šæ¬¡æµ‹è¯•**: åœ¨ä¸åŒæ—¶é—´æµ‹è¯•ä»¥ç¡®ä¿ç»“æœç¨³å®š

## è¾“å‡ºç¤ºä¾‹

```
ğŸ† å…¨å±€æœ€ä½ Z åæ ‡:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   ä½ç½®:
      X = 0.3000 m
      Y = -0.8000 m
      Z = 0.4250 m  â¬…ï¸ æœ€ä½ç‚¹!

   å§¿æ€: vertical_down
      å››å…ƒæ•°: [0.500, -0.500, -0.500, 0.500]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ROS2 æœåŠ¡è°ƒç”¨å‘½ä»¤:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ros2 service call /move_arm dual_arm_agv_moveit/srv/MoveArm "{
  control_mode: 'arm_l',
  target_pose_left: {
    position: {x: 0.30000, y: -0.80000, z: 0.42500},
    orientation: {x: 0.500, y: -0.500, z: -0.500, w: 0.500}
  }
}"
```

## æ€»ç»“

è¿™ä¸ªå·¥å…·éå¸¸é€‚åˆ:
- âœ… ç¬¬ä¸€æ¬¡ä½¿ç”¨æ–°æœºå™¨äººæ—¶,äº†è§£å…¶å·¥ä½œç©ºé—´
- âœ… è®¾è®¡å·¥ä½œå°å¸ƒå±€æ—¶,ç¡®å®šæœ€ä¼˜æ“ä½œé«˜åº¦
- âœ… è§„åˆ’ä»»åŠ¡æ—¶,æ‰¾åˆ°æœ€ä½³æ¥è¿‘è·¯å¾„
- âœ… è°ƒè¯•æ—¶,éªŒè¯å·¥ä½œç©ºé—´è¾¹ç•Œ
